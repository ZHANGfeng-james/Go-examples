# 1 篇1

之前在阅读代码方面存在认知误区，一开始就从入口开始阅读，并不停地跳转，试图理清每一个细节。这种方式会让阅读代码的过程比较煎熬，耗费时间长效果却不好，不是正确的做法。**==正确的做法==**是==先看森林再观树木==，即**先对整个项目的代码结构有基本认知，摸清项目代码的实现套路，然后按需逐行阅读**。

## 1.1 阅读源代码核心思想

摆正认识，对阅读代码这件事**有正确的认识**很重要，==核心思想指导行动==，方法构建在核心思想之上，如果核心思想不正确，方法就不可靠。核心思想用比较现代的语言表述就是：==元认知==。

我们要阅读的代码**不是一堆杂乱文件和字符**，而**是经过深思熟虑、精心安排好的，是有内在规律的**，越是庞大成熟、被广泛使用的项目越是如此，这一认识是后续方法的基本盘：

1. 要相信有几十年发展历史的**软件工程**是有料的，我们现在能看到重要项目不会是杂乱无序的；
2. 要相信前辈大牛们创造的各种**编程技术**是在**降低编码阅读难度**的；
3. 要相信重要开源项目的**核心开发人员的水平是很高的**，他们在方法论方面的认识和水准超过绝大多数人；
4. 要相信技术水平高的人是喜欢制定并**遵循套路的**，这些套路会让工作更简单，阅读开发代码的过程更轻松。

在初次阅读代码的时候，**首要目标就是找到「套路」**，并时刻保持清醒，避免过早陷入细节而忘记了首要目标。

## 1.2 找到入口

万事开头难，刚刚开始接触一个全新的陌生项目时，是最难受的，因为一无所知。这时候如果自己能够把代码编译成可执行的文件，并知道了程序的入口位置，内心的焦躁就会大幅减少，因为剩下的就是时间问题了。

除非是构建过程特别复杂的项目，否则一定要自己编译一遍，并阅读 `makefile` 或者编译脚本，大概了解作者维护这套代码的方式。大部分开源项目都会在 README.md、Install 等文档中详细介绍编译、部署的方法，通常是2~3个命令，无脑执行即可，但有时候会遇到比较烦恼的挫折。

第一个常见挫折是因为国内特殊的网络环境，一些需要从网上获取的资源被卡住，导致构建不通过，这个挫折除了找一个全局代理的「维劈N」似乎没有其它的破解方法了。

第二个常见挫折是有些项目的构建过程本身就很复杂，并且大量运用 `makefile` 和 shell 的特性，为寻找程序入口增加了重重障碍。这个挫折除了硬着头皮去看或者直接找人问，似乎也没有其它破解方法了。

另外现在比较流行用 docker 做环境编译，这种方式使构建环境统一带来不少益处，但对于要掌握构建过程的人来说，在 `makefile` 和 shell 之外又需要掌握一套工具，对于完全不了解 docker，特别是对一些经验尚浅的在校生来说，是个不小的障碍。

有些项目还用到了其它比较小众的构建工具…没有什么好办法，多看多学，见多了就熟了！

## 1.3 梳理目录

找到程序入口之后，不用着急从入口阅读代码，先把所有的目录看一下，大概了解目录的层次结构和用途，这样会事半功倍。如果没有搞清楚目录结构，就从入口开始阅读代码，每次跳转都进入一个完全陌生的目录或文件中，连续跳转几次就完全陷入到具体目录中，找不回主线了。

在梳理目录的时候，如果目录下有说明文件一定要仔细阅读，然后快速扫视目录中每个文件的内容。文件开头的注释要认真看，文件中比较复杂的结构体、类、函数或方法列表等要关注，通过快速扫视对每个目录的用途有一个大概的判断。

这个阶段酌情了解一下函数或者方法的实现即可，一般情况下只要看一下函数或方法的名字，就能大概猜到这个目录中代码的用途。即使完全判断不出某个目录的用途也不要紧，提前扫视一遍至少眼熟，在后面逐行阅读代码时，没准就串联起来并瞬间想通了。随着了解的目录越来越多，对整个项目的代码结构的认识越来越清晰，最终完成了从0到1的认知构建。

认知构建的过程是比较不愉快的，因为要在完全陌生的内容里折腾，**贵在坚持**，「眼熟」了，就顺畅了，最后如鱼得水、酣畅淋漓。有一个技巧可以应用，扫视的时候在心里不停地问，这段代码是在干嘛？逼迫自己从更高的维度去看和想，而不是只见树木不见森林的陷入到细节中。

## 1.4 逐行阅读

对项目的目录结构有了基本认知之后，接下来就是最后一步：从程序入口开始逐行阅读。这期间经常遇到没见过的函数或者代码库，还有一些设计模式相关的代码。老外写代码特别喜欢用 factory、helper 等等，各种传递各种类型转换，还有各种自动生成的代码，往往要向下穿透好几层才能找到熟悉的直白执行的代码。

第一个应对方法很简单：见得多了，就熟悉了；第二个应对方法是：掌握好阅读的深度。如果不是特殊需要，遇到一个陌生的库只需要知道它是什么、能用来做什么怎么用，至于是怎么实现的可以先不关心。要把时间和精力用在主线上，别一头扎入某个库的细节，忘了当前项目的主线，变成研究另一个项目了。

特别是一些使用了框架的项目，先知道框架怎么用，把当前项目搞清楚后，再去研究框架自身是怎么实现的。

掌握好阅读深度非常关键，因为代码浩如烟海，是读不完的，只依赖标准库的项目还好一些，否则 A 引 B、B 引 C，最终代码量成指数型增加。==要善于抽象总结==，逐行读代码，不是逐行看字母 `abcd`，而是揣摩这些代码表达的意思，透过代码把握作者的思路想法。有时候代码实在太复杂了，那就有选择的阅读，譬如看到一整屏的初始化代码，如果去追究每个初始化是在干嘛的，等折腾明白了，黄花菜都凉了。我们先知道这里是在做初始化就好了，然后继续往下，等遇到困难或者有需要的时候，再回过头来研究相关的初始化代码。

# 2 篇2

> 来自：[如何阅读 Golang 源码？](https://www.zhihu.com/question/327615791)

Go 的源码在安装包的 src/ 目录下。怎么看它的源码呢？直接看吧！没人教的情况下，只能自己撸了。当然，这种内容一般也不会有人教。

怎么撸？

Go 源码中，应该可分为**与语言息息相关的部分**，和**官方提供的标准库**。与语言实现相关的肯定是最难的，不是那么容易理解。**可以先主要看标准库**，其他的可以先大概了解下，待准备充足，再开始艰难的任务（==先易后难的原则==）。

第一步，浏览源码目录，大概看看涉及了哪些模块，再挑自己喜欢的部分进行更深一步的学习与研究。建议每个库都看下官方文档，简单写个 hello world，才会体悟更深。如果连 hello world 都写不出来，这个模块的源码暂时就没必要研究了，先学好基础吧。毕竟，**包的使用**不仅与语言相关，**还涉及具体场景和实现原理**，这都是要学习的。（**先学者使用包，尽量在多个场景下使用**）

第二步，对包的使用熟悉理解后，就可以阅读源码了，但此时最好还是**不要太抠细节，大概理解涉及设计思想，整体流程**。源码阅读可以通过画 UML 的方式辅助，从纵向和横向帮助理解。代码设计时，一般最容易想到的就是按顺序方式写，很快就能搞定。但当项目变大，抽象的模块会越来越多，抽象出接口和具体的实现，实现可能包含其他类型的组合。搞明白这些关系，对于理解源码实现会较有帮助。我觉得，经过这一步，包的使用就很得心应手了。（**大致弄明白逻辑和流程**）

第三步，如果顺利经过前面两步，如果该包没有太多领域知识，接下来的源码阅读就比较简单了。Go 语言的特点就是简洁易读，没什么语法糖。当然，**如果是一些实现比较复杂的包，你还需知道它们的底层原理**，就比如 net/http 包，你得对 http 协议熟悉到一定程度，才可能从细节研究源码实现。 是否要到第三步，视自己的情况而定，能到这一步应该就能达到源码随意改，基本没啥后顾之忧的层次了。

推荐两本书，分别是 《Go 语言学习笔记》，后半部分有源码的解读。另外一本，《Go 语言高级编程》，对 cgo 和汇编有非常仔细的介绍。

可能是我闲的蛋疼，准备试着先从第一步出发，整体撸一下 Go 的源码中包含的模块，没事的时候就更新一点进去。等把这些大致撸完一遍，感觉我的 Golang 之旅 专栏又可以多出很多写作素材了。

我的环境是 Go 1.11。关于每个模块，我会把读过的一些文章放在下面，由于只是粗略阅读，并不能保证读过的每篇文章都是精品。

> 补充：
>
> 2019年8月8日 凌晨 01:13， 大概花了两个多星期的零碎时间，简单撸完了一版。总的感觉，还是有很多地方理解不够，希望后面可以按前面说的思路，按包逐步进行源码解剖。

1. 如果你阅读的是 syscall包，恭喜你，感觉正常：再简洁的语言，遇到环境相关，仍然会有很多 tricks，甚至用到 Cgo。
2. 如果你阅读的是 os 一类的包，恭喜你，感觉也挺正常：涉及到与其他层面的调用， 正常。
3. 如果你阅读的是 net/http 一类的包，那么可能是你对这部分协议不大理解，可以先看看相关的 RFC 之类的，应该会容易得多。
4. 如果你阅读的是它的解释器和编译器，那么你需要先有一点编译原理的基础，至少你得知道什么是 lexer，什么是 parser，好歹能用 yacc 实现一个玩具语言，会轻松很多。
5. 如果你阅读了math等包，那么很有可能是你相关算法、细节知识不足（对于并发有关的包也是如此），这不是语言的原因，是素养的问题，可以选择相应的进行适当的知识扩充。
6. 可以==**先从 strings，bufio，io/ioutils 这一类不大需要背景知识的包开始**==，感受 Golang 标准库的魅力。（可以先从不需要背景知识的包开始！也就是由简入深，先看相对独立的简单模块，比如 map、slice、channel 等）
7. 借助注释，英文不理解的可以借助机器翻译。




